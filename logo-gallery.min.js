!function(t){"use strict";function e(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")}function s(t,e){var s=i(t,e)?n:r;s(t,e)}var i,r,n;"classList"in document.documentElement?(i=function(t,e){return t.classList.contains(e)},r=function(t,e){t.classList.add(e)},n=function(t,e){t.classList.remove(e)}):(i=function(t,s){return e(s).test(t.className)},r=function(t,e){i(t,e)||(t.className=t.className+" "+e)},n=function(t,s){t.className=t.className.replace(e(s)," ")});var a={hasClass:i,addClass:r,removeClass:n,toggleClass:s,has:i,add:r,remove:n,toggle:s};"function"==typeof define&&define.amd?define(a):t.classie=a}(window),function(t){"use strict";function e(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}function s(t){for(var e=[],s=t.length,r=t[0].length,n=0;s>n;n++)e=e.concat(t[n]);e=i(e);for(var a=[],o=0,h=0;s>h;h++){for(var c=[],l=0;r>l;l++)c.push(e[o]),o++;a.push(c)}return a}function i(t){for(var e=t.length,s,i;e;)i=Math.floor(Math.random()*e--),s=t[e],t[e]=t[i],t[i]=s;return t}function r(t,s){this.el=t,this.inner=this.el.querySelector("div"),this.allItems=[].slice.call(this.inner.children),this.allItemsCount=this.allItems.length,this.allItemsCount&&(this.items=[].slice.call(this.inner.querySelectorAll("figure:not([data-dummy])")),this.itemsCount=this.items.length,this.current=0,this.options=e({},this.options),e(this.options,s),this._init())}Modernizr.addTest("csstransformspreserve3d",function(){var e=Modernizr.prefixed("transformStyle"),s="preserve-3d",i;return e?(e=e.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"),Modernizr.testStyles("#modernizr{"+e+":"+s+";}",function(s,r){i=t.getComputedStyle?getComputedStyle(s,null).getPropertyValue(e):""}),i===s):!1});var n={transitions:Modernizr.csstransitions,preserve3d:Modernizr.csstransformspreserve3d},a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},o=a[Modernizr.prefixed("transition")];r.prototype.options={},r.prototype._init=function(){this.currentItem=this.items[this.current],this._addNavigation(),this._getSizes(),this._initEvents()},r.prototype._addNavigation=function(){this.nav=document.createElement("nav");for(var t="",e=0;e<this.itemsCount;++e)t+="<span></span>";this.nav.innerHTML=t,this.el.appendChild(this.nav),this.navDots=[].slice.call(this.nav.children)},r.prototype._initEvents=function(){var e=this,s=classie.hasClass(this.el,"photostack-start"),i=function(){var t=function(){n.transitions&&classie.addClass(e.el,"photostack-transition")};s?(this.removeEventListener("click",i),classie.removeClass(e.el,"photostack-start"),t()):(e.openDefault=!0,setTimeout(t,25)),e.started=!0,e._showPhoto(e.current)};s?(this._shuffle(),this.el.addEventListener("click",i)):i(),this.navDots.forEach(function(t,s){t.addEventListener("click",function(){if(s===e.current)e._rotateItem();else{var t=function(){e._showPhoto(s)};e.flipped?e._rotateItem(t):t()}})}),t.addEventListener("resize",function(){e._resizeHandler()})},r.prototype._resizeHandler=function(){function t(){e._resize(),e._resizeTimeout=null}var e=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(t,100)},r.prototype._resize=function(){var t=this,e=function(){t._shuffle(!0)};this._getSizes(),this.started&&this.flipped?this._rotateItem(e):e()},r.prototype._showPhoto=function(t){return this.isShuffling?!1:(this.isShuffling=!0,classie.hasClass(this.currentItem,"photostack-flip")&&(this._removeItemPerspective(),classie.removeClass(this.navDots[this.current],"flippable")),classie.removeClass(this.navDots[this.current],"current"),classie.removeClass(this.currentItem,"photostack-current"),this.current=t,this.currentItem=this.items[this.current],classie.addClass(this.navDots[this.current],"current"),this.currentItem.querySelector(".photostack-back")&&classie.addClass(this.navDots[t],"flippable"),void this._shuffle())},r.prototype._shuffle=function(t){var e=t?1:this.currentItem.getAttribute("data-shuffle-iteration")||1;(0>=e||!this.started||this.openDefault)&&(e=1),this.openDefault&&(classie.addClass(this.currentItem,"photostack-flip"),this.openDefault=!1,this.isShuffling=!1);var i=.5,r=Math.ceil(this.sizes.inner.width/(this.sizes.item.width*i)),a=Math.ceil(this.sizes.inner.height/(this.sizes.item.height*i)),h=r*this.sizes.item.width*i+this.sizes.item.width/2-this.sizes.inner.width,c=a*this.sizes.item.height*i+this.sizes.item.height/2-this.sizes.inner.height,l=h/2,m=c/2,p=35,u=-35,d=this,f=function(){--e;for(var t=[],h=0;a>h;++h)for(var c=t[h]=[],v=0;r>v;++v){var y=v*d.sizes.item.width*i-l,g=h*d.sizes.item.height*i-m,I=0,x=0;if(d.started&&0===e){var z=d._isOverlapping({x:y,y:g});if(z.overlapping){I=z.noOverlap.x,x=z.noOverlap.y;var k=Math.floor(3*Math.random());switch(k){case 0:I=0;break;case 1:x=0}}}c[v]={x:y+I,y:g+x}}t=s(t);var _=0,C=0,w=0;d.allItems.forEach(function(s,i){_===r-1?(C=C===a-1?0:C+1,_=1):++_;var h=Math.floor(Math.random()*r),c=Math.floor(Math.random()*a),l=t[C][_-1],m={x:l.x,y:l.y},v=function(){++w,n.transitions&&this.removeEventListener(o,v),w===d.allItemsCount&&(e>0?f.call():(classie.addClass(d.currentItem,"photostack-flip"),d.isShuffling=!1,"function"==typeof d.options.callback&&d.options.callback(d.currentItem)))};d.items.indexOf(s)===d.current&&d.started&&0===e?(d.currentItem.style.WebkitTransform="translate("+d.centerItem.x+"px,"+d.centerItem.y+"px) rotate(0deg)",d.currentItem.style.msTransform="translate("+d.centerItem.x+"px,"+d.centerItem.y+"px) rotate(0deg)",d.currentItem.style.transform="translate("+d.centerItem.x+"px,"+d.centerItem.y+"px) rotate(0deg)",d.currentItem.querySelector(".photostack-back")&&d._addItemPerspective(),classie.addClass(d.currentItem,"photostack-current")):(s.style.WebkitTransform="translate("+m.x+"px,"+m.y+"px) rotate("+Math.floor(Math.random()*(p-u+1)+u)+"deg)",s.style.msTransform="translate("+m.x+"px,"+m.y+"px) rotate("+Math.floor(Math.random()*(p-u+1)+u)+"deg)",s.style.transform="translate("+m.x+"px,"+m.y+"px) rotate("+Math.floor(Math.random()*(p-u+1)+u)+"deg)"),d.started&&(n.transitions?s.addEventListener(o,v):v())})};f.call()},r.prototype._getSizes=function(){this.sizes={inner:{width:this.inner.offsetWidth,height:this.inner.offsetHeight},item:{width:this.currentItem.offsetWidth,height:this.currentItem.offsetHeight}},this.centerItem={x:this.sizes.inner.width/2-this.sizes.item.width/2,y:this.sizes.inner.height/2-this.sizes.item.height/2}},r.prototype._isOverlapping=function(t){var e=this.sizes.item.width+this.sizes.item.width/3,s=this.sizes.item.height+this.sizes.item.height/3,i={x:this.sizes.inner.width/2-e/2,y:this.sizes.inner.height/2-s/2},r=this.sizes.item.width,n=this.sizes.item.height;if(!(t.x+r<i.x||t.x>i.x+e||t.y+n<i.y||t.y>i.y+s)){var a=Math.random()<.5,o=Math.floor(Math.random()*(r/4+1)),h=Math.floor(Math.random()*(n/4+1)),c=a?-1*(t.x-i.x+r)-o:i.x+e-(t.x+r)+r+o,l=a?-1*(t.y-i.y+n)-h:i.y+s-(t.y+n)+n+h;return{overlapping:!0,noOverlap:{x:c,y:l}}}return{overlapping:!1}},r.prototype._addItemPerspective=function(){classie.addClass(this.el,"photostack-perspective")},r.prototype._removeItemPerspective=function(){classie.removeClass(this.el,"photostack-perspective"),classie.removeClass(this.currentItem,"photostack-flip")},r.prototype._rotateItem=function(t){if(classie.hasClass(this.el,"photostack-perspective")&&!this.isRotating&&!this.isShuffling){this.isRotating=!0;var e=this,s=function(){n.transitions&&n.preserve3d&&this.removeEventListener(o,s),e.isRotating=!1,"function"==typeof t&&t()};this.flipped?(classie.removeClass(this.navDots[this.current],"flip"),n.preserve3d?(this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)",this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)"):classie.removeClass(this.currentItem,"photostack-showback")):(classie.addClass(this.navDots[this.current],"flip"),n.preserve3d?(this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+"px) rotateY(-179.9deg)",this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+"px) rotateY(-179.9deg)"):classie.addClass(this.currentItem,"photostack-showback")),this.flipped=!this.flipped,n.transitions&&n.preserve3d?this.currentItem.addEventListener(o,s):s()}},t.Photostack=r}(window),new Photostack(document.getElementById("photostack"),{callback:function(t){}});